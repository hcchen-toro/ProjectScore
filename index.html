<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆé¡Œæˆç¸¾å€‹äººè²¢ç»åº¦èª¿æ•´ç³»çµ± (Excelç‰ˆ)</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #f4f4f9;
            margin: 20px;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 30px;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            border-top: 5px solid #2c3e50;
        }
        /* é˜¿è«›å¥‰æ‰¿å€å¡Šé–‹å§‹ */
        .controls {
            margin-bottom: 25px;
            text-align: center;
            padding: 25px;
            background: linear-gradient(to bottom, #ffffff, #f7fbff);
            border: 1px solid #cce0ff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .honorific-label {
            display: block;
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .honorific-sub {
            font-size: 0.9em;
            color: #555;
            font-weight: normal;
        }
        select {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 50px;
            border: 2px solid #bdc3c7;
            width: 300px;
            background-color: #fff;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        select:hover {
            border-color: #3498db;
        }
        .welcome-banner {
            background-color: #fff8e1; /* æ·¡é‡‘è‰²èƒŒæ™¯ */
            border-left: 5px solid #f1c40f; /* é‡‘è‰²é‚Šæ¡† */
            color: #856404;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 1.05em;
            display: none; /* é è¨­éš±è— */
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* é˜¿è«›å¥‰æ‰¿å€å¡ŠçµæŸ */

        .group-card {
            border: 1px solid #e0e0e0;
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            background-color: #fff;
            transition: transform 0.2s;
        }
        .group-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .group-header {
            background-color: #34495e;
            color: #fff;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .group-title {
            font-size: 1.1em;
            font-weight: bold;
            flex-grow: 1;
            margin-right: 15px;
        }
        .group-score {
            background-color: #e74c3c;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }
        tr:last-child td {
            border-bottom: none;
        }
        input[type="number"] {
            width: 60px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            text-align: center;
            font-size: 1em;
            font-weight: bold;
            color: #2c3e50;
        }
        input[type="number"]:focus {
            border-color: #3498db;
            outline: none;
            background-color: #f0f8ff;
        }
        .calculated-score {
            font-weight: bold;
            color: #27ae60;
            font-size: 1.2em;
        }
        .btn-export {
            display: block;
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #219150, #27ae60);
        }
        .hidden {
            display: none;
        }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .group-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .group-score {
                margin-top: 8px;
            }
            select {
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>å°ˆé¡Œçµ„å“¡æˆç¸¾æ¬Šé‡èª¿æ•´ç³»çµ±</h1>
    <p class="subtitle">Personal Contribution Adjustment System</p>
    
    <div class="controls">
        <label for="teacherSelect" class="honorific-label">
            è‡´ å°Šæ•¬çš„æ•™æˆéˆé‘’ï¼š<br>
            <span class="honorific-sub">æ„Ÿè¬æ‚¨æœ¬å­¸æœŸå°å­¸ç”Ÿçš„æ‚‰å¿ƒæŒ‡å°èˆ‡ä»˜å‡ºï¼Œæ‡‡è«‹é»é¸æ‚¨çš„å°Šç¨±ä»¥é–‹å§‹è©•åˆ†ï¼š</span>
        </label>
        <select id="teacherSelect" onchange="renderGroups()">
            <option value="">-- æ•¬è«‹é»é¸æ‚¨çš„å°Šå§“å¤§å --</option>
        </select>
    </div>

    <div id="welcomeBanner" class="welcome-banner"></div>

    <div id="groupsContainer">
        <p style="text-align: center; color: #999; margin-top: 30px; font-style: italic;">
            (ç­‰å¾…æ•™æˆé¸æ“‡ä¸­...)
        </p>
    </div>

    <button class="btn-export hidden" id="exportBtn" onclick="exportXLSX()">
        ğŸ’¾ å„²å­˜ä¸¦åŒ¯å‡º Excel å ±è¡¨ (.xlsx)
    </button>
</div>

<script>
    // è³‡æ–™ä¾†æºï¼šæ ¹æ“šæœ€æ–°ç´”æ–‡å­—æª”èˆ‡åœ–ç‰‡åˆ†æ•¸å»ºç«‹
    const rawData = [
        {id:1, teacher:"è‹—æ–°å…ƒè€å¸«", topic:"ç™‚ç™’å‹æ©Ÿå™¨äºº", score:92, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360122", name:"é™³é›¯ç‘¾"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360127", name:"é™³ç¾¿èª "}, {c:"é›»æ©Ÿä¸‰A", id:"s11360141", name:"èŠèˆ’è"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360239", name:"å¾ç‘›è”š"}
        ]},
        {id:2, teacher:"è‹—æ–°å…ƒè€å¸«", topic:"æµ´å®¤æ¸…æ½”æ©Ÿå™¨äºº", score:84, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360146", name:"æéƒé”"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360229", name:"è¨±æŸå´´"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360241", name:"ææ´§è¾°"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360249", name:"é«˜æ¯“å‡"}
        ]},
        {id:3, teacher:"è‹—æ–°å…ƒè€å¸«", topic:"åŸºæ–¼è¿‘ç´…å¤–å½±åƒçš„AI é©…å‹•çš„çƒ˜ç„™éç¨‹ç„¡å‰µæª¢æ¸¬æ–¹æ³•", score:98, members:[
            {c:"é›»æ©Ÿå››B", id:"s09360244", name:"æ—å®¸å®‡"}, {c:"è³‡å·¥ä¸‰C", id:"s11350329", name:"æ—å®¶ç·¯"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360111", name:"ä½•æ±å¡"}
        ]},
        {id:4, teacher:"é˜ç‰èŠ³è€å¸«", topic:"æ‡‰ç”¨æ©Ÿå™¨å­¸ç¿’è¼”åŠ©ç³–å°¿ç—…é¢¨éšªè­˜åˆ¥ä¹‹ç ”ç©¶", score:81, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360130", name:"é‚±ç¥¥æ©"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360244", name:"å¼µç½çš“"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360159", name:"æ¥Šç«£å®‰"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360162", name:"æ—å† å®‡"}
        ]},
        {id:5, teacher:"è”¡å¤éœ–è€å¸«", topic:"åŸºæ–¼RISC-Vçš„å½±åƒè™•ç†ALUæ ¸å¿ƒæ”¹è‰¯", score:93, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360125", name:"æ¢å‰å®—"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360102", name:"å³ç¾½å®‰"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360115", name:"é™³ç¦¹ç‘„"}
        ]},
        {id:6, teacher:"è”¡å¤éœ–è€å¸«", topic:"æ™ºæ…§è¾²å ´ä¹‹ç ”ç©¶ä»¥ç•ªèŒ„ç—…èŸ²å®³ç‚ºä¾‹", score:84, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360131", name:"æ—å† å‚‘"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360129", name:"é™³ä½³å®‰"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360144", name:"æ¸¸å ¯å ƒ"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360145", name:"é»ƒèˆ‡æ¡"}
        ]},
        {id:7, teacher:"åŠ‰æ—¥æ–°è€å¸«", topic:"ä»¥æ°§åŒ–é‹…å¥ˆç±³ç®¡å¼·åŒ–ç¢³æåŠå°é«”ä¹‹å…‰é›»æ•ˆæ‡‰", score:92, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360108", name:"æ›¾æŸå ¯"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360116", name:"é‡‘æ¡“ç† "}, {c:"é›»æ©Ÿä¸‰A", id:"s11360132", name:"æ—æ˜€è‡»"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360119", name:"èŒƒè‡´éš†"}
        ]},
        {id:8, teacher:"åŠ‰æ—¥æ–°è€å¸«", topic:"ä»¥æ°§åŒ–éµå¼·åŒ–ç¢³æåŠå°é«”ä¹‹å…‰é›»æ•ˆæ‡‰", score:85, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360109", name:"é»ƒä¿Šè±ª"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360202", name:"èƒ¡ä¿Šå®‡"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360218", name:"é„­åšæ‡Œ"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360250", name:"é‚±è©®å¯Œ"}
        ]},
        {id:9, teacher:"åŠ‰æ—¥æ–°è€å¸«", topic:"ä»¥çŸ½å¥ˆç±³ç®¡å¼·åŒ–ç¢³æåŠå°é«”ä¹‹å…‰é›»æ•ˆæ‡‰", score:91, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360121", name:"é¦¬æ¢ƒå®¶"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360136", name:"åŠ‰ç¿æ‰¿"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360106", name:"ç‹èµ«è¾°"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360161", name:"æ—å¥‰è«­"}
        ]},
        {id:10, teacher:"åŠ‰æ—¥æ–°è€å¸«", topic:"ä»¥ç¢³æåŠå°é«”å¯¦ç¾è»Ÿè³ªéˆ£éˆ¦ç¤¦å¤ªé™½èƒ½é›»æ± ", score:91, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360216", name:"é™³ç«£è©³"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360201", name:"æ´ªç¿Šå®¸"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360214", name:"å²³ç¦¹æˆ"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360242", name:"æ—æŸå¿—"}
        ]},
        {id:11, teacher:"åŠ‰æ—¥æ–°è€å¸«", topic:"ä»¥æ°®åŒ–éµå¼·åŒ–ç¢³æåŠå°é«”ä¹‹å…‰é›»ç‰¹æ€§", score:91, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360220", name:"æ¸¸æ‰¿ç¿°"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360147", name:"è¬é§é§¿"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360236", name:"æœ±é®å®‡"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360224", name:"é„§åœ‹å¥•"}
        ]},
        {id:12, teacher:"é™³éŒ¡æ¥“è€å¸«", topic:"ç”¨æ–¼ä½è»Œè¡›æ˜Ÿä¹‹å¸¶é€šæ¿¾æ³¢å™¨ç ”ç™¼", score:96, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360101", name:"è”¡ç‘‹è±ª"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360104", name:"è¢è£•é †"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360143", name:"å³æ˜†ç‘‹"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360205", name:"å³æ˜æ¾¤"}
        ]},
        {id:13, teacher:"é™³éŒ¡æ¥“è€å¸«", topic:"ç”¨æ–¼ 5G é€šè¨Šç³»çµ±ä¹‹åå°„å¼è² è¼‰ç›¸ç§»å™¨çš„ç ”ç©¶èˆ‡è¨­è¨ˆ", score:84, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360203", name:"æ—åº­è–‡"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360219", name:"é„­ç‚˜æœ‹"}, {c:"é›»æ©Ÿå››A", id:"s10360148", name:"è”¡æ›¸å¼˜"}
        ]},
        {id:14, teacher:"è¨±éŠ˜å…¨è€å¸«", topic:"LDOç©©å£“å™¨è¨­è¨ˆèˆ‡è² è¼‰èª¿è®Šæ¨¡æ“¬", score:81, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360231", name:"æç››è¯"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360110", name:"æ¥Šå½¥åº·"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360113", name:"æ—ä¾‘ç’‡"}, {c:"é›»æ©Ÿä¸‰A", id:"S11360138", name:"é»ƒç£èŠ¯"}
        ]},
        {id:15, teacher:"é™³éŒ¡æ¥“è€å¸«", topic:"ç’°å½¢éœ‡ç›ªå™¨", score:82, members:[
            {c:"é›»æ©Ÿå››B", id:"s10340110", name:"æéŸ‹é‹"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360118", name:"æ—å²³ç¿°"}
        ]},
        {id:16, teacher:"é™³éŒ¡æ¥“è€å¸«", topic:"ä½¿ç”¨Ltspiceæ¨¡æ“¬äºŒç´šæ”¾å¤§å™¨ä¹‹å°ä¿¡è™Ÿæ€§èƒ½èˆ‡æ—è·¯å…ƒä»¶æ•ˆæ‡‰", score:81, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360204", name:"è³´å½¥å»·"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360221", name:"ç¨‹æ‡·è±"}
        ]},
        {id:17, teacher:"è¨±éŠ˜å…¨è€å¸«", topic:"æŠ—æº«åº¦è®Šç•°ä¹‹é‹ç®—æ”¾â¼¤å™¨", score:84, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11490012", name:"è”¡å®šå€«"}, {c:"é›»æ©Ÿä¸‰B", id:"s11340201", name:"åŠ‰æ¯…æ–‡"}
        ]},
        {id:18, teacher:"é™³æ˜±ä»è€å¸«", topic:"åŸºæ–¼SLAMæƒæåŠŸèƒ½ä¹‹â¾ƒå‹•è¦åŠƒè·¯å¾‘â¾ƒâ¾›â¾", score:81, members:[
            {c:"é›»æ©Ÿå››A", id:"s10360125", name:"è‘‰ç§‰æ¡“"}, {c:"é›»æ©Ÿå››B", id:"s10360237", name:"æ—å‰‡è¨€"}
        ]},
        {id:19, teacher:"é™³æ˜±ä»è€å¸«", topic:"å¹³â¾¯å¯å»¶ä¼¸æ©Ÿæ¢°â¼¿è‡‚çµåˆæ·±åº¦å­¸ç¿’ä¹‹æ‡‰â½¤", score:83, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360123", name:"æ—å† æ¼¢"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360228", name:"å·«ç´¹é½Š"}, {c:"é›»æ©Ÿä¸‰B", id:"S10310139", name:"æ—å®¶å‡±"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360150", name:"é™³å½¥å‡"}
        ]},
        {id:20, teacher:"ç”°é’ç¦¾è€å¸«", topic:"ç„¡é‰›éˆ£éˆ¦ç¤¦æ™¶é«”æˆâ»‘ä¹‹ç ”ç©¶", score:82, members:[
            {c:"é›»æ©Ÿå››B", id:"s10360215", name:"å»–æŸå‡±"}, {c:"é›»æ©Ÿå››A", id:"s10360144", name:"å·«æ—»å“²"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360107", name:"åŠ‰æ´¸å®‡"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360252", name:"è‘£å† å‘ˆ"}, {c:"é›»æ©Ÿå››B", id:"s09360243", name:"è˜‡é–è±ª"}
        ]},
        {id:21, teacher:"ç”°é’ç¦¾è€å¸«", topic:"è¡¨é¢è²æ³¢æ„Ÿæ¸¬å™¨", score:80, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360112", name:"å³å¾¡å²‘"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360142", name:"æ´ªæ™®ä¿®"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360149", name:"é™³å˜‰ç¿”"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360238", name:"ä½•æ±éœ–"}
        ]},
        {id:22, teacher:"ç”°é’ç¦¾è€å¸«", topic:"æ°§åŒ–éµè–„è†œé‡‘å±¬æ‘»é›œä¹‹ Arduino è‘¡è„ç³–æ„Ÿæ¸¬å™¨ç ”ç©¶èˆ‡è£½ä½œ", score:85, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360117", name:"é¡ä¸ç¥¥"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360133", name:"å³å˜‰å®¸"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360217", name:"å¸¸æ™‰ç‘‹"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360210", name:"å¾æ™§åº­"}
        ]},
        {id:23, teacher:"ç”°é’ç¦¾è€å¸«", topic:"å…·å‹•æ…‹è£œæµåŠŸèƒ½ä¹‹å¤ªé™½èƒ½è¿½å…‰èˆ‡å„²èƒ½æ•´åˆç³»çµ±é–‹ç™¼", score:81, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360134", name:"æå·§ç­ "}, {c:"é›»æ©Ÿä¸‰A", id:"s11360137", name:"æ—å²³é‹’"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360223", name:"é»ƒé´»è«­"}
        ]},
        {id:24, teacher:"ç”°é’ç¦¾è€å¸«", topic:"æ•¸ä½å¾®æµé«”æ„Ÿæ¸¬å™¨", score:80, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360207", name:"è³´å¼ˆæ‰"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360208", name:"ææ²›å„’"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360222", name:"é»ƒç¾¤ç¥"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360246", name:"é™³é¼å‹›"}
        ]},
        {id:25, teacher:"ç”°é’ç¦¾è€å¸«", topic:"é›™æ¿å¾®æµé“æ™¶â½š", score:80, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360227", name:"é»ƒå»ºé¨°"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360124", name:"æ–½ç¶“ä½‘"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360206", name:"é„­å®¸ä¾‘"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360253", name:"è˜‡ç…œå‡±"}
        ]},
        {id:26, teacher:"ç”°é’ç¦¾è€å¸«", topic:"åˆ©â½¤ç©ºé–“é™åˆ¶é€†æº«çµæ™¶æ³•æˆâ»‘ç„¡é‰›éˆ£éˆ¦ç¤¦æ™¶é«”ä¹‹ç ”ç©¶", score:78, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360243", name:"é»ƒæ•¬æ·"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360126", name:"é„­å®‰éˆ"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360148", name:"é»ƒä¿¡è±ª"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360215", name:"ç‹æŒ¯è©®"}
        ]},
        {id:27, teacher:"ç”°é’ç¦¾è€å¸«", topic:"å–®æ¿é›»æ§æ™¶â½š", score:78, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360261", name:"å³è²æ¬"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360265", name:"é¡å‘ˆè«­"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360156", name:"è•­ä¸å¦¤"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360257", name:"ä½˜æ˜è«º"}
        ]},
        {id:28, teacher:"è¨±éŠ˜å…¨è€å¸«", topic:"åŸºæ–¼å½±åƒè¾¨è­˜ä¹‹â¾ƒâ¾›â¾é¿éšœç ”ç©¶", score:80, members:[
            {c:"é›»æ©Ÿä¸‰A", id:"s11360103", name:"ç™½æ‰¿å¶§"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360235", name:"å¼µæœ‰é®"}
        ]},
        {id:29, teacher:"è¨±éŠ˜å…¨è€å¸«", topic:"ç¾¤çµ„æ©Ÿå™¨â¼ˆéšŠå½¢è®Šæ›ä¹‹æ¼”ç®—æ³•åˆ†æ", score:80, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360209", name:"åŠ‰èŠ¸å®‰"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360120", name:"è”¡å®‡æ™´"}
        ]},
        {id:30, teacher:"è¨±éŠ˜å…¨è€å¸«", topic:"â¾ƒä¸»ç§»å‹•å¹³å°çµåˆæ©Ÿæ¢°â¼¿è‡‚ä¹‹ç’°å¢ƒè³‡æºæ¢æ¸¬â¾è¨­è¨ˆ", score:84, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360237", name:"è—è»’ç¿°"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360244", name:"å»–æ˜±é–"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360232", name:"é­å®å®‡"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360114", name:"å³è±è“‰"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360140", name:"ææ´‹è³¢"}
        ]},
        {id:31, teacher:"è¨±éŠ˜å…¨è€å¸«", topic:"å…·è¦–è¦ºè§¸ç™¼è£œæ‰åæ‡‰ä¹‹ä»¿è³è‚æ©Ÿå™¨ç³»çµ±è¨­è¨ˆèˆ‡å¯¦ä½œ", score:81, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360245", name:"é™³ç‚«è±ª"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360233", name:"é™³éŸ‹å‡±"}
        ]},
        {id:32, teacher:"é™³éŒ¡æ¥“è€å¸«", topic:"åŸºæ–¼FPGAä¹‹å¤šé€šé“éº¥å…‹é¢¨è²æºå®šä½ç³»çµ±", score:94, members:[
            {c:"é›»æ©Ÿä¸‰B", id:"s11360234", name:"ç‹æŸç‚º"}, {c:"é›»æ©Ÿä¸‰A", id:"s11360105", name:"æ´ªç®æš‰"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360248", name:"ç™½èŠ¸ç¶º"}, {c:"é›»æ©Ÿä¸‰B", id:"s11360247", name:"éƒ­é®æ„·"}
        ]}
    ];

    // åˆå§‹åŒ–é é¢
    window.onload = function() {
        const teacherSelect = document.getElementById('teacherSelect');
        const teachers = [...new Set(rawData.map(item => item.teacher))]; // æå–å”¯ä¸€è€å¸«åå–®
        
        teachers.forEach(t => {
            const option = document.createElement('option');
            option.value = t;
            option.textContent = t;
            teacherSelect.appendChild(option);
        });
    };

    // æ¸²æŸ“çµ„åˆ¥å¡ç‰‡
    function renderGroups() {
        const teacher = document.getElementById('teacherSelect').value;
        const container = document.getElementById('groupsContainer');
        const exportBtn = document.getElementById('exportBtn');
        const welcomeBanner = document.getElementById('welcomeBanner');
        
        container.innerHTML = '';

        if (!teacher) {
            container.innerHTML = '<p style="text-align: center; color: #999; margin-top: 30px; font-style: italic;">(ç­‰å¾…æ•™æˆé¸æ“‡ä¸­...)</p>';
            exportBtn.classList.add('hidden');
            welcomeBanner.style.display = 'none';
            return;
        }

        // é¡¯ç¤ºæ­¡è¿æ©«å¹…ï¼Œä¸¦åŠ å…¥é˜¿è«›å¥‰æ‰¿çš„æ–‡å­—
        welcomeBanner.textContent = `âœ¨ ${teacher} æ‚¨å¥½ï¼Œè¾›è‹¦äº†ï¼æ„Ÿè¬æ‚¨å°å­¸ç”Ÿçš„æ‚‰å¿ƒæŒ‡å°ã€‚ä»¥ä¸‹æ˜¯æ‚¨æŒ‡å°çš„å°ˆé¡Œçµ„åˆ¥ï¼š`;
        welcomeBanner.style.display = 'block';

        exportBtn.classList.remove('hidden');
        
        // ç¯©é¸è©²è€å¸«çš„çµ„åˆ¥
        const groups = rawData.filter(g => g.teacher === teacher);

        groups.forEach((group) => {
            const card = document.createElement('div');
            card.className = 'group-card';
            
            let html = `
                <div class="group-header">
                    <span class="group-title">é¡Œç›®ï¼š${group.topic}</span>
                    <span class="group-score">çµ„åˆ¥æˆç¸¾ï¼š${group.score}</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="width: 15%">ç­ç´š</th>
                            <th style="width: 20%">å­¸è™Ÿ</th>
                            <th style="width: 20%">å§“å</th>
                            <th style="width: 20%">è²¢ç»åº¦ (%)</th>
                            <th style="width: 25%">å¯¦å¾—æˆç¸¾</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            group.members.forEach((member, memIndex) => {
                const inputId = `score_${group.id}_${memIndex}`;
                html += `
                    <tr>
                        <td>${member.c}</td>
                        <td>${member.id}</td>
                        <td>${member.name}</td>
                        <td>
                            <input type="number" id="${inputId}" value="100" min="0" max="100" 
                                oninput="calculateScore(${group.id}, ${memIndex}, ${group.score})">
                        </td>
                        <td>
                            <span id="final_${group.id}_${memIndex}" class="calculated-score">${group.score}</span>
                        </td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;
            
            card.innerHTML = html;
            container.appendChild(card);
        });
    }

    // è¨ˆç®—åˆ†æ•¸é‚è¼¯
    function calculateScore(groupId, memIndex, baseScore) {
        const input = document.getElementById(`score_${groupId}_${memIndex}`);
        const output = document.getElementById(`final_${groupId}_${memIndex}`);
        
        let percent = parseFloat(input.value);
        if (percent > 100) {
            percent = 100;
            input.value = 100;
        } else if (percent < 0) {
            percent = 0;
            input.value = 0;
        } else if (isNaN(percent)) {
            percent = 0;
        }

        // è¨ˆç®—é‚è¼¯ï¼šçµ„æˆç¸¾ * ç™¾åˆ†æ¯” (å››æ¨äº”å…¥è‡³å°æ•¸é»å¾Œ1ä½)
        const finalScore = (baseScore * (percent / 100)).toFixed(1);
        output.textContent = finalScore.replace('.0', ''); // å¦‚æœæ˜¯æ•´æ•¸å°±å»æ‰ .0
    }

    // åŒ¯å‡º Excel (XLSX) é‚è¼¯
    function exportXLSX() {
        const teacher = document.getElementById('teacherSelect').value;
        if (!teacher) return;

        // æº–å‚™è¦åŒ¯å‡ºçš„è³‡æ–™é™£åˆ—
        const data = [];
        // åŠ å…¥æ¨™é¡Œåˆ—
        data.push(["æŒ‡å°è€å¸«", "é¡Œç›®", "çµ„åˆ¥æˆç¸¾", "ç­ç´š", "å­¸è™Ÿ", "å§“å", "è²¢ç»åº¦(%)", "å€‹äººå¯¦å¾—æˆç¸¾"]);

        const groups = rawData.filter(g => g.teacher === teacher);

        groups.forEach(group => {
            group.members.forEach((member, memIndex) => {
                const inputId = `score_${group.id}_${memIndex}`;
                const inputElement = document.getElementById(inputId);
                // ç¢ºä¿èƒ½è®€å–åˆ°ç›®å‰ç•«é¢ä¸Šçš„å€¼ï¼Œå¦‚æœé‚„æ²’æ¸²æŸ“å‰‡é è¨­100
                const percent = inputElement ? inputElement.value : 100;
                
                const finalScore = (group.score * (percent / 100)).toFixed(1).replace('.0', '');

                const row = [
                    group.teacher,
                    group.topic,
                    group.score,
                    member.c,
                    member.id,
                    member.name,
                    percent, // åŒ¯å‡ºæ™‚ä¹Ÿä¿ç•™ç™¾åˆ†æ¯”
                    finalScore
                ];
                data.push(row);
            });
        });

        // å»ºç«‹ Workbook
        const ws = XLSX.utils.aoa_to_sheet(data);
        
        // è¨­å®šæ¬„å¯¬ (é¸å¡«ï¼Œè®“Excelæ¯”è¼ƒå¥½çœ‹)
        const wscols = [
            {wch: 15}, // è€å¸«
            {wch: 40}, // é¡Œç›®
            {wch: 10}, // çµ„æˆ
            {wch: 15}, // ç­ç´š
            {wch: 15}, // å­¸è™Ÿ
            {wch: 12}, // å§“å
            {wch: 12}, // è²¢ç»åº¦
            {wch: 12}  // å¯¦å¾—
        ];
        ws['!cols'] = wscols;

        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "æˆç¸¾ç¢ºèªè¡¨");

        // ä¸‹è¼‰æª”æ¡ˆ
        XLSX.writeFile(wb, `${teacher}_å°ˆé¡Œæˆç¸¾ç¢ºèªè¡¨.xlsx`);
    }
</script>

</body>

</html>

